# SLO/SLI/SLA: <spec-slug>

> Google SREã«åŸºã¥ãä¿¡é ¼æ€§ç›®æ¨™å®šç¾©ã€‚é‹ç”¨å¯èƒ½æ€§ã‚’å®šé‡çš„ã«ä¿è¨¼ã™ã‚‹ã€‚

## 1. æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ | <ã‚µãƒ¼ãƒ“ã‚¹å> |
| å®šç¾©æ—¥ | YYYY-MM-DD |
| ãƒ¬ãƒ“ãƒ¥ãƒ¼å‘¨æœŸ | å››åŠæœŸ |
| æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼ | YYYY-MM-DD |

## 2. SLIï¼ˆService Level Indicatorsï¼‰

### 2.1 å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰

| SLI | å®šç¾© | æ¸¬å®šæ–¹æ³• | ç¾åœ¨å€¤ |
|-----|------|---------|--------|
| **ãƒªã‚¯ã‚¨ã‚¹ãƒˆæˆåŠŸç‡** | 2xx/3xx ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‰²åˆ | `success_requests / total_requests * 100` | 99.5% |
| **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æˆåŠŸç‡** | /health 200å¿œç­”ã®å‰²åˆ | Synthetic monitoring | 99.9% |

**è¨ˆæ¸¬ã‚¯ã‚¨ãƒªï¼ˆPrometheusï¼‰**:
```promql
# å¯ç”¨æ€§ï¼ˆ5åˆ†é–“ï¼‰
sum(rate(http_requests_total{status=~"2..|3.."}[5m]))
/
sum(rate(http_requests_total[5m]))
* 100
```

### 2.2 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼ˆLatencyï¼‰

| SLI | å®šç¾© | æ¸¬å®šæ–¹æ³• | ç¾åœ¨å€¤ |
|-----|------|---------|--------|
| **P50 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·** | 50ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å¿œç­”æ™‚é–“ | `histogram_quantile(0.50, ...)` | 50ms |
| **P95 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·** | 95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å¿œç­”æ™‚é–“ | `histogram_quantile(0.95, ...)` | 150ms |
| **P99 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·** | 99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å¿œç­”æ™‚é–“ | `histogram_quantile(0.99, ...)` | 300ms |

**è¨ˆæ¸¬ã‚¯ã‚¨ãƒªï¼ˆPrometheusï¼‰**:
```promql
# P99ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
histogram_quantile(0.99,
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
)
```

### 2.3 ã‚¨ãƒ©ãƒ¼ç‡ï¼ˆError Rateï¼‰

| SLI | å®šç¾© | æ¸¬å®šæ–¹æ³• | ç¾åœ¨å€¤ |
|-----|------|---------|--------|
| **HTTPã‚¨ãƒ©ãƒ¼ç‡** | 5xx ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‰²åˆ | `error_requests / total_requests * 100` | 0.1% |
| **ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼ç‡** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã®å‰²åˆ | ã‚¢ãƒ—ãƒªãƒ­ã‚°é›†è¨ˆ | 0.5% |

### 2.4 ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆThroughputï¼‰

| SLI | å®šç¾© | æ¸¬å®šæ–¹æ³• | ç¾åœ¨å€¤ |
|-----|------|---------|--------|
| **RPS** | 1ç§’ã‚ãŸã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ•° | `sum(rate(http_requests_total[1m]))` | 1000 |
| **åŒæ™‚æ¥ç¶šæ•°** | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•° | `nginx_connections_active` | 500 |

## 3. SLOï¼ˆService Level Objectivesï¼‰

### 3.1 SLOå®šç¾©

| ID | SLI | SLO Target | æ¸¬å®šæœŸé–“ | Error Budget |
|----|-----|------------|---------|--------------|
| SLO-001 | å¯ç”¨æ€§ | >= 99.5% | 30æ—¥é–“ | 0.5% = 3.6æ™‚é–“/æœˆ |
| SLO-002 | P99ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | < 500ms | 30æ—¥é–“ | - |
| SLO-003 | P95ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | < 200ms | 30æ—¥é–“ | - |
| SLO-004 | ã‚¨ãƒ©ãƒ¼ç‡ | < 0.1% | 30æ—¥é–“ | 0.1% |

### 3.2 Error Budgetè¨ˆç®—

```
Error Budget = 100% - SLO Target

ä¾‹: SLO 99.5% ã®å ´åˆ
- Error Budget = 0.5%
- 30æ—¥é–“ = 43,200åˆ†
- è¨±å®¹ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  = 43,200 Ã— 0.5% = 216åˆ† = 3.6æ™‚é–“
```

| SLO | Target | Error Budgetï¼ˆ30æ—¥ï¼‰ | Error Budgetï¼ˆ1å¹´ï¼‰ |
|-----|--------|---------------------|---------------------|
| 99.9% | 0.1% | 43åˆ† | 8.7æ™‚é–“ |
| 99.5% | 0.5% | 216åˆ†ï¼ˆ3.6æ™‚é–“ï¼‰ | 43.8æ™‚é–“ |
| 99.0% | 1.0% | 432åˆ†ï¼ˆ7.2æ™‚é–“ï¼‰ | 87.6æ™‚é–“ |

### 3.3 SLO ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**Grafanaè¨­å®šä¾‹**:
```json
{
  "title": "SLO Dashboard",
  "panels": [
    {
      "title": "Availability SLO",
      "type": "gauge",
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{status=~\"2..|3..\"}[30d])) / sum(rate(http_requests_total[30d])) * 100"
        }
      ],
      "thresholds": [99.0, 99.5, 99.9]
    }
  ]
}
```

## 4. SLAï¼ˆService Level Agreementï¼‰

> SLAã¯é¡§å®¢ã¨ã®å¥‘ç´„ã€‚SLOã‚ˆã‚Šç·©ãè¨­å®šã—ã€ãƒãƒƒãƒ•ã‚¡ã‚’æŒãŸã›ã‚‹ã€‚

### 4.1 SLAå®šç¾©

| é …ç›® | SLAä¿è¨¼ | ãƒšãƒŠãƒ«ãƒ†ã‚£ |
|------|--------|-----------|
| å¯ç”¨æ€§ | >= 99.0%/æœˆ | ä¸‹å›ã£ãŸå ´åˆã€æœˆé¡ã®10%ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ |
| è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | æœˆ4æ™‚é–“ä»¥å†… | è¶…é1æ™‚é–“ã”ã¨ã«5%ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåˆå‹• | P1: 15åˆ†ä»¥å†… | è¶…éã§1%ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè§£æ±º | P1: 4æ™‚é–“ä»¥å†… | è¶…éã§5%ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ |

### 4.2 é™¤å¤–äº‹é …

ä»¥ä¸‹ã¯SLAè¨ˆç®—ã‹ã‚‰é™¤å¤–:
- è¨ˆç”»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆäº‹å‰é€šçŸ¥48æ™‚é–“ä»¥ä¸Šï¼‰
- é¡§å®¢èµ·å› ã®éšœå®³
- ä¸å¯æŠ—åŠ›ï¼ˆå¤©ç½ã€æ³•è¦åˆ¶ï¼‰
- ç¬¬ä¸‰è€…ã‚µãƒ¼ãƒ“ã‚¹éšœå®³ï¼ˆAWSç­‰ï¼‰

## 5. Error Budget Policy

### 5.1 æ¶ˆè²»ç‡ã«å¿œã˜ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³

| Error Budgetæ¶ˆè²» | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|-----------------|-----------|-----------|
| 0-50% | ğŸŸ¢ Healthy | é€šå¸¸é–‹ç™ºç¶™ç¶š |
| 50-75% | ğŸŸ¡ Warning | ãƒªã‚¹ã‚¯é«˜ã„å¤‰æ›´ã¯ä¿ç•™ |
| 75-100% | ğŸŸ  Critical | æ–°æ©Ÿèƒ½é–‹ç™ºåœæ­¢ã€ä¿¡é ¼æ€§æ”¹å–„å„ªå…ˆ |
| 100%+ | ğŸ”´ Exhausted | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œãƒ¢ãƒ¼ãƒ‰ |

### 5.2 ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

```yaml
# Prometheus Alerting Rules
groups:
  - name: slo-alerts
    rules:
      - alert: ErrorBudgetBurnRate
        expr: |
          (1 - (
            sum(rate(http_requests_total{status=~"2..|3.."}[1h]))
            /
            sum(rate(http_requests_total[1h]))
          )) > 0.001
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Error budget burning fast ({{ $value | humanizePercentage }})"

      - alert: SLOViolation
        expr: |
          (
            sum(rate(http_requests_total{status=~"2..|3.."}[30d]))
            /
            sum(rate(http_requests_total[30d]))
          ) < 0.995
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "SLO violation: availability below 99.5%"
```

## 6. æ¸¬å®šãƒ»ãƒ¬ãƒãƒ¼ãƒˆ

### 6.1 æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ

- Error Budgetæ®‹é‡
- å‰æ—¥ã®SLIå€¤
- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿæœ‰ç„¡

### 6.2 é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼

- SLI/SLOãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- Error Budgetæ¶ˆè²»ç‡
- æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é€²æ—

### 6.3 æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ

- SLOé”æˆçŠ¶æ³
- Error Budgetæ¶ˆè²»å†…è¨³
- æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã‚µãƒãƒªãƒ¼
- æ¬¡æœˆã®æ”¹å–„è¨ˆç”»

## 7. é–¢é€£è¦ä»¶ï¼ˆrequirements.mdã«è¿½åŠ ï¼‰

```markdown
### REQ-NFR-001: å¯ç”¨æ€§
- ç¨®åˆ¥: EARS-æ™®é
- å„ªå…ˆåº¦: MUST
- è¦ä»¶æ–‡(EARS): ã‚·ã‚¹ãƒ†ãƒ ã¯30æ—¥é–“ã§99.5%ä»¥ä¸Šã®å¯ç”¨æ€§ã‚’ç¶­æŒã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
- å—å…¥ãƒ†ã‚¹ãƒˆ(GWT): Given 30æ—¥é–“ã®é‹ç”¨ When å¯ç”¨æ€§ã‚’è¨ˆæ¸¬ Then 99.5%ä»¥ä¸Šã§ã‚ã‚‹

### REQ-NFR-002: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
- ç¨®åˆ¥: EARS-æ™®é
- å„ªå…ˆåº¦: MUST
- è¦ä»¶æ–‡(EARS): ã‚·ã‚¹ãƒ†ãƒ ã¯P99ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’500msæœªæº€ã«ç¶­æŒã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
- å—å…¥ãƒ†ã‚¹ãƒˆ(GWT): Given è² è·ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ When P99ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨ˆæ¸¬ Then 500msæœªæº€
```

## 8. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [requirements.md](./requirements.md) - éæ©Ÿèƒ½è¦ä»¶
- [runbook.md](./runbook.md) - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ
- [design.md](./design.md) - å¯è¦³æ¸¬æ€§è¨­è¨ˆ
